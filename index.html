<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>颜色展示器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;  /* 改为顶部对齐 */
            min-height: 100vh;
            margin: 0;
            padding-top: 5vh;  /* 添加固定的顶部间距 */
            background-color: #f5f5f7;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', sans-serif;
            color: #1d1d1f;
        }

        .wrapper {
            display: flex;
            flex-direction: row;
            gap: 2rem;
            width: 100%;
            max-width: 1200px;
            padding: 0 2rem;
            box-sizing: border-box;
            min-height: 90vh;  /* 确保wrapper有足够的高度 */
        }

        .main-section {
            flex: 0 0 440px;
            position: sticky;  /* 固定主容器位置 */
            top: 5vh;  /* 与body的padding-top相同 */
            height: fit-content;  /* 高度适应内容 */
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
            line-height: 1.1;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
        }

        .page-subtitle {
            font-size: 1.1rem;
            font-weight: 400;
            color: #86868b;
            margin-bottom: 2rem;
            letter-spacing: 0;
            line-height: 1.4;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .input-group {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        select, input {
            padding: 0.8rem 1rem;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            width: 100%;
            box-sizing: border-box;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background-color: rgba(255, 255, 255, 0.8);
            -webkit-appearance: none;
            appearance: none;
        }

        select {
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1.41.59L6 5.17 10.59.59 12 2 6 8 0 2z' fill='%23666'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            padding-right: 2.5rem;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .input-container {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 0;
            align-items: flex-end;
        }

        .number-input {
            width: 80px !important;
            text-align: center;
            padding: 0.8rem 0.5rem;
        }

        .separator {
            display: flex;
            align-items: center;
            color: #86868b;
            font-size: 1.2rem;
            padding-bottom: 0.8rem;
        }

        .input-label {
            font-size: 0.85rem;
            color: #86868b;
            margin-bottom: 0.3rem;
        }

        .color-display {
            width: 100%;
            height: 220px;
            background-color: #393737;
            border-radius: 16px;
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            gap: 0.8rem;
            padding: 1.5rem;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        #colorName {
            font-size: 1rem;
            font-weight: 500;
        }

        .color-info {
            font-size: 0.8rem;
            text-align: center;
            white-space: pre-line;
            line-height: 1.6;
            opacity: 0.9;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-top: 1.5rem;
        }

        .action-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.8rem;
            border-radius: 50%;
            transition: all 0.2s ease;
            color: #1d1d1f;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .action-button:hover {
            background-color: rgba(0, 0, 0, 0.05);
            transform: scale(1.1);
        }

        .action-button i {
            font-size: 1.2rem;
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }

        .search-section {
            flex: 1;
            padding-bottom: 5vh;  /* 底部添加间距 */
        }

        .search-results {
            position: sticky;
            top: 5vh;  /* 与主容器对齐 */
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            overflow-y: auto;
            display: none;
            box-sizing: border-box;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            max-height: 90vh;  /* 最大高度与wrapper一致 */
        }

        .search-results.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .color-item {
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 0.95rem;
            word-break: break-word;
            margin-bottom: 0.8rem;
        }

        .color-item:last-child {
            margin-bottom: 0;
        }

        .color-item:hover {
            transform: scale(1.02);
        }

        .search-results-title {
            font-size: 0.9rem;
            color: #86868b;
            margin-bottom: 1rem;
            text-align: center;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 1024px) {
            body {
                padding-top: 2rem;  /* 移动端减小顶部间距 */
            }

            .wrapper {
                flex-direction: column;
                padding: 0 1rem;
                min-height: auto;  /* 移除最小高度限制 */
            }

            .main-section {
                position: static;  /* 移除固定定位 */
                width: 100%;
                max-width: 440px;
                margin: 0 auto;
            }

            .search-section {
                width: 100%;
                max-width: 440px;
                margin: 0 auto;
                padding-bottom: 2rem;
            }

            .search-results {
                position: static;
                max-height: none;
                margin-top: 1rem;
            }
        }

        @media (max-width: 480px) {
            .wrapper {
                padding: 1rem;
            }

            .container {
                padding: 1.5rem;
            }

            .search-results {
                padding: 1.2rem;
            }

            .page-title {
                font-size: 1.75rem;
                margin-bottom: 1rem;
            }

            .page-subtitle {
                font-size: 1rem;
                margin-bottom: 1.5rem;
            }
        }

        /* 添加滚动条样式 */
        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .search-results::-webkit-scrollbar-track {
            background: transparent;
        }

        .search-results::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .search-results::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* 添加色彩灵感容器样式 */
        .color-inspirations {
            margin-top: 1.5rem;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .color-inspirations.show {
            display: block;
        }

        .inspiration-group {
            margin-bottom: 1.5rem;
        }

        .inspiration-title {
            font-size: 0.9rem;
            color: #86868b;
            margin-bottom: 0.8rem;
        }

        .inspiration-colors {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.8rem;
        }

        .inspiration-color {
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .inspiration-color:hover {
            transform: scale(1.05);
        }

        .inspiration-color::after {
            content: attr(data-hex);
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-size: 0.75rem;
            padding: 0.3rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .inspiration-color:hover::after {
            opacity: 1;
        }

        /* Footer styles */
        .footer {
            width: 100%;
            padding: 1.5rem 0;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 100;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copyright {
            color: #86868b;
            font-size: 0.9rem;
        }

        .github-link {
            color: #1d1d1f;
            font-size: 1.5rem;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .github-link:hover {
            color: #0071e3;
        }

        @media (max-width: 480px) {
            .footer-content {
                padding: 0 1rem;
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="main-section">
            <h1 class="page-title">颜色展示器</h1>
            <p class="page-subtitle">探索、转换和管理颜色</p>
            <div class="container">
                <div class="input-group">
                    <select id="colorType">
                        <option value="hex">Hex / CSS</option>
                        <option value="rgb">RGB</option>
                        <option value="hsl">HSL</option>
                        <option value="hsb">HSB</option>
                    </select>
                    <div id="inputFields">
                        <!-- 动态插入输入框 -->
                    </div>
                </div>
                <div class="color-display" id="colorBox">
                    <span id="colorName">深灰色</span>
                    <span id="colorInfo" class="color-info"></span>
                </div>
                <div class="action-buttons">
                    <button class="action-button" id="copyButton" title="复制颜色代码">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="action-button" id="saveButton" title="保存为图片">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="action-button" id="inspirationButton" title="生成色彩灵感">
                        <i class="fas fa-magic"></i>
                    </button>
                </div>
            </div>
            <div class="color-inspirations" id="colorInspirations">
                <!-- 动态插入色彩灵感 -->
            </div>
        </div>
        <div class="search-section">
            <div class="search-results" id="searchResults">
                <div class="search-results-title"></div>
                <!-- 动态插入搜索结果 -->
            </div>
        </div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <footer class="footer">
        <div class="footer-content">
            <span class="copyright">© 2024 Color Display. All rights reserved.</span>
            <a href="https://github.com/timetxt/color-display" target="_blank" class="github-link" title="View on GitHub">
                <i class="fab fa-github"></i>
            </a>
        </div>
    </footer>

    <script>
        const colorType = document.getElementById('colorType');
        const colorBox = document.getElementById('colorBox');
        const colorName = document.getElementById('colorName');
        const colorInfo = document.getElementById('colorInfo');
        const pageTitle = document.querySelector('.page-title');
        const pageSubtitle = document.querySelector('.page-subtitle');
        
        // 声明颜色数据变量
        let colorData = [];

        // 添加语言配置
        const i18n = {
            'zh': {
                title: '颜色展示器',
                subtitle: '探索、转换和管理颜色',
                inputHint: '请输入颜色值',
                hexPlaceholder: '输入Hex值或颜色名称 (例如: FF0000 或 中国红)',
                rgbPlaceholder: '输入RGB值',
                hslPlaceholder: '输入HSL值',
                hsbPlaceholder: '输入HSB值',
                cssPlaceholder: '输入CSS颜色名称 (例如: red)',
                invalidColor: '无效的颜色值',
                initialHint: '请输入颜色代码或名称',
                customColor: '自定义颜色',
                searchResultsTitle: '候选颜色',
                gradientTitle: '渐变过渡',
                analogousTitle: '相近色调',
                complementaryTitle: '对比色',
                temperatureTitle: '暖冷平衡',
                copySuccess: '复制成功',
                copyFailed: '复制失败',
                saveSuccess: '图片已保存',
                saveFailed: '保存失败，请重试',
                generateSuccess: '已生成色彩灵感',
                selectColorFirst: '请先选择一个颜色'
            },
            'en': {
                title: 'Color Display',
                subtitle: 'Explore, Convert and Manage Colors',
                inputHint: 'Enter color value',
                hexPlaceholder: 'Enter Hex value or color name (e.g. FF0000 or Chinese Red)',
                rgbPlaceholder: 'Enter RGB value',
                hslPlaceholder: 'Enter HSL value',
                hsbPlaceholder: 'Enter HSB value',
                cssPlaceholder: 'Enter CSS color name (e.g. red)',
                invalidColor: 'Invalid color value',
                initialHint: 'Please enter a color code or name',
                customColor: 'Custom Color',
                searchResultsTitle: 'Color Candidates',
                gradientTitle: 'Gradient Transition',
                analogousTitle: 'Analogous Colors',
                complementaryTitle: 'Complementary Colors',
                temperatureTitle: 'Temperature Balance',
                copySuccess: 'Copied successfully',
                copyFailed: 'Copy failed',
                saveSuccess: 'Image saved',
                saveFailed: 'Save failed, please try again',
                generateSuccess: 'Color inspirations generated',
                selectColorFirst: 'Please select a color first'
            }
        };

        // 获取当前语言
        const currentLang = (navigator.language || navigator.userLanguage).startsWith('zh') ? 'zh' : 'en';
        const texts = i18n[currentLang];

        // 更新页面标题和副标题
        pageTitle.textContent = texts.title;
        pageSubtitle.textContent = texts.subtitle;

        // 更新搜索结果标题
        document.querySelector('.search-results-title').textContent = texts.searchResultsTitle;

        // 更新页面标题
        document.title = texts.title;

        // 修改默认颜色为动态初始化
        let currentColor = {
            hex: '',
            rgb: { r: 0, g: 0, b: 0 },
            hsl: { h: 0, s: 0, l: 0 },
            hsb: { h: 0, s: 0, b: 0 },
            css: ''
        };

        // 修改加载颜色数据函数
        async function loadColorData() {
            try {
                const response = await fetch('./colors.json');
                const data = await response.json();
                colorData = data.colors;
                // 初始化时不设置默认颜色，而是显示提示信息
                colorBox.style.backgroundColor = '#F0F0F0';
                colorName.textContent = texts.initialHint;
                colorInfo.textContent = '';
            } catch (error) {
                console.error('加载颜色数据失败:', error);
                colorBox.style.backgroundColor = '#F0F0F0';
                colorName.textContent = '颜色数据加载失败';
                colorInfo.textContent = '';
            }
        }

        function getBaseColorRange(h) {
            // 定义基础色系的色相范围
            const colorRanges = [
                { name: '红', range: [345, 10], center: 0 },
                { name: '橙', range: [10, 40], center: 25 },
                { name: '黄', range: [40, 70], center: 55 },
                { name: '绿', range: [70, 150], center: 110 },
                { name: '青', range: [150, 190], center: 170 },
                { name: '蓝', range: [190, 240], center: 215 },
                { name: '紫', range: [240, 290], center: 265 },
                { name: '粉', range: [290, 345], center: 317 }
            ];

            // 处理色相值超过360的情况
            h = h % 360;
            if (h < 0) h += 360;

            // 查找对应的色系
            for (const range of colorRanges) {
                if (range.range[0] <= range.range[1]) {
                    if (h >= range.range[0] && h < range.range[1]) {
                        return range;
                    }
                } else {
                    // 处理跨越360度的情况（比如红色）
                    if (h >= range.range[0] || h < range.range[1]) {
                        return range;
                    }
                }
            }
            return null;
        }

        function getColorDistance(color1, color2) {
            // 解析HSL值
            const getHSL = (color) => {
                const [h, s, l] = color.hsl.split(',').map(v => parseFloat(v));
                return { h, s, l };
            };

            const hsl1 = getHSL(color1);
            const hsl2 = getHSL(color2);

            // 计算色相差异（考虑360度循环）
            let hDiff = Math.abs(hsl1.h - hsl2.h);
            if (hDiff > 180) hDiff = 360 - hDiff;

            // 计算饱和度和亮度的差异
            const sDiff = Math.abs(hsl1.s - hsl2.s);
            const lDiff = Math.abs(hsl1.l - hsl2.l);

            // 综合计算颜色距离（给予色相更高的权重）
            return hDiff * 2 + sDiff + lDiff;
        }

        function createInputFields(type) {
            const container = document.getElementById('inputFields');
            container.innerHTML = '';
            const searchResults = document.getElementById('searchResults');

            const handleSearch = (value) => {
                if (value.length > 0) {
                    // 显示搜索结果容器
                    searchResults.classList.add('show');

                    // 搜索匹配的颜色
                    const searchValue = value.toLowerCase();
                    const matchedColors = colorData.filter(color => {
                        const colorName = color.name.toLowerCase();
                        const colorHex = color.hex.toLowerCase();
                        const colorRgb = color.rgb.toLowerCase();
                        const colorHsl = color.hsl.toLowerCase();
                        const colorHsb = color.hsb.toLowerCase();
                        const colorCss = color.css.toLowerCase();
                        
                        return colorName.includes(searchValue) ||
                               colorHex.includes(searchValue) ||
                               colorRgb.includes(searchValue) ||
                               colorHsl.includes(searchValue) ||
                               colorHsb.includes(searchValue) ||
                               colorCss.includes(searchValue);
                    });

                    if (matchedColors.length > 0) {
                        searchResults.innerHTML = `
                            <div class="search-results-title">${texts.searchResultsTitle} (${matchedColors.length})</div>
                            ${matchedColors.map(color => `
                                <div class="color-item" 
                                     style="background-color: ${color.hex}"
                                     data-color='${JSON.stringify(color)}'
                                     title="${color.name}">
                                    ${color.name}
                                </div>
                            `).join('')}
                        `;

                        // 为每个颜色项添加点击事件
                        const colorItems = searchResults.querySelectorAll('.color-item');
                        colorItems.forEach(item => {
                            item.addEventListener('click', () => {
                                const colorData = JSON.parse(item.dataset.color);
                                currentColor = {
                                    hex: colorData.hex,
                                    rgb: colorData.rgb,
                                    hsl: colorData.hsl,
                                    hsb: colorData.hsb,
                                    css: colorData.css
                                };
                                // 更新输入框
                                switch (type) {
                                    case 'hex':
                                        document.querySelector('#colorInput').value = colorData.hex.replace('#', '');
                                        break;
                                    case 'rgb':
                                        const rgbValues = colorData.rgb.split(',').map(n => parseInt(n.trim()));
                                        document.querySelectorAll('.number-input').forEach((input, index) => {
                                            input.value = rgbValues[index];
                                        });
                                        break;
                                    case 'hsl':
                                        const hslValues = colorData.hsl.split(',').map(n => parseInt(n.trim()));
                                        document.querySelectorAll('.number-input').forEach((input, index) => {
                                            input.value = hslValues[index];
                                        });
                                        break;
                                    case 'hsb':
                                        const hsbValues = colorData.hsb.split(',').map(n => parseInt(n.trim()));
                                        document.querySelectorAll('.number-input').forEach((input, index) => {
                                            input.value = hsbValues[index];
                                        });
                                        break;
                                    case 'css':
                                        document.querySelector('#colorInput').value = colorData.css;
                                        break;
                                }

                                // 更新颜色显示
                                colorBox.style.backgroundColor = colorData.hex;
                                colorName.textContent = colorData.name;
                                colorInfo.textContent = `HEX: ${colorData.hex}\nRGB: ${colorData.rgb}\nHSL: ${colorData.hsl}\nHSB: ${colorData.hsb}\nCSS: ${colorData.css}`;
                            });
                        });
                    } else {
                        searchResults.classList.remove('show');
                    }
                }
            };

            switch (type) {
                case 'hex':
                    const hexInput = document.createElement('input');
                    hexInput.type = 'text';
                    hexInput.id = 'colorInput';
                    hexInput.placeholder = texts.hexPlaceholder;
                    hexInput.value = currentColor.hex ? currentColor.hex.replace('#', '') : '';
                    container.appendChild(hexInput);
                    hexInput.addEventListener('input', (e) => handleSearch(e.target.value));
                    break;

                case 'rgb':
                    const rgbContainer = document.createElement('div');
                    rgbContainer.className = 'input-container';
                    rgbContainer.innerHTML = `
                        <div>
                            <div class="input-label">R</div>
                            <input type="number" class="number-input" min="0" max="255" value="${currentColor.rgb ? currentColor.rgb.r : ''}" data-index="0">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">G</div>
                            <input type="number" class="number-input" min="0" max="255" value="${currentColor.rgb ? currentColor.rgb.g : ''}" data-index="1">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">B</div>
                            <input type="number" class="number-input" min="0" max="255" value="${currentColor.rgb ? currentColor.rgb.b : ''}" data-index="2">
                        </div>
                    `;
                    container.appendChild(rgbContainer);
                    rgbContainer.querySelectorAll('.number-input').forEach(input => {
                        input.addEventListener('input', (e) => handleSearch(e.target.value));
                    });
                    break;

                case 'hsl':
                    const hslContainer = document.createElement('div');
                    hslContainer.className = 'input-container';
                    hslContainer.innerHTML = `
                        <div>
                            <div class="input-label">H</div>
                            <input type="number" class="number-input" min="0" max="360" value="${currentColor.hsl ? currentColor.hsl.h : ''}" data-index="0">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">S</div>
                            <input type="number" class="number-input" min="0" max="100" value="${currentColor.hsl ? currentColor.hsl.s : ''}" data-index="1">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">L</div>
                            <input type="number" class="number-input" min="0" max="100" value="${currentColor.hsl ? currentColor.hsl.l : ''}" data-index="2">
                        </div>
                    `;
                    container.appendChild(hslContainer);
                    hslContainer.querySelectorAll('.number-input').forEach(input => {
                        input.addEventListener('input', (e) => handleSearch(e.target.value));
                    });
                    break;

                case 'hsb':
                    const hsbContainer = document.createElement('div');
                    hsbContainer.className = 'input-container';
                    hsbContainer.innerHTML = `
                        <div>
                            <div class="input-label">H</div>
                            <input type="number" class="number-input" min="0" max="360" value="${currentColor.hsb ? currentColor.hsb.h : ''}" data-index="0">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">S</div>
                            <input type="number" class="number-input" min="0" max="100" value="${currentColor.hsb ? currentColor.hsb.s : ''}" data-index="1">
                        </div>
                        <span class="separator">,</span>
                        <div>
                            <div class="input-label">B</div>
                            <input type="number" class="number-input" min="0" max="100" value="${currentColor.hsb ? currentColor.hsb.b : ''}" data-index="2">
                        </div>
                    `;
                    container.appendChild(hsbContainer);
                    hsbContainer.querySelectorAll('.number-input').forEach(input => {
                        input.addEventListener('input', (e) => handleSearch(e.target.value));
                    });
                    break;

                case 'css':
                    const cssInput = document.createElement('input');
                    cssInput.type = 'text';
                    cssInput.id = 'colorInput';
                    cssInput.placeholder = texts.cssPlaceholder;
                    cssInput.value = currentColor.css;
                    container.appendChild(cssInput);
                    cssInput.addEventListener('input', (e) => handleSearch(e.target.value));
                    break;
            }

            // 为新创建的输入框添加事件监听
            const inputs = container.querySelectorAll('input');
            inputs.forEach(input => {
                input.removeEventListener('input', updateColor);
                input.removeEventListener('paste', updateColor);
                input.removeEventListener('keyup', updateColor);

                input.addEventListener('input', updateColor);
                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pasteData = e.clipboardData.getData('text');
                    const start = input.selectionStart;
                    const end = input.selectionEnd;
                    const currentValue = input.value;
                    input.value = currentValue.substring(0, start) + pasteData + currentValue.substring(end);
                    input.selectionStart = input.selectionEnd = start + pasteData.length;
                    updateColor();
                    handleSearch(input.value);
                });
                input.addEventListener('keyup', updateColor);
            });
        }

        function getContrastColor(hexColor) {
            // 将十六进制颜色转换为RGB
            const r = parseInt(hexColor.slice(1, 3), 16);
            const g = parseInt(hexColor.slice(3, 5), 16);
            const b = parseInt(hexColor.slice(5, 7), 16);
            
            // 计算对比色
            const contrastR = 255 - r;
            const contrastG = 255 - g;
            const contrastB = 255 - b;
            
            // 创建浅色版本（与原对比色混合白色）
            const lightR = Math.round(contrastR * 0.3 + 255 * 0.7);
            const lightG = Math.round(contrastG * 0.3 + 255 * 0.7);
            const lightB = Math.round(contrastB * 0.3 + 255 * 0.7);
            
            return `rgb(${lightR}, ${lightG}, ${lightB})`;
        }

        function updateSearchResultsBackground(color) {
            const searchResults = document.querySelector('.search-results');
            if (!searchResults) return;
            
            // 如果颜色是有效的十六进制颜色
            if (color && color.startsWith('#')) {
                const contrastColor = getContrastColor(color);
                searchResults.style.backgroundColor = contrastColor;
            } else {
                // 默认背景色
                searchResults.style.backgroundColor = '#f0f0f0';
            }
        }

        function updateColor() {
            const type = colorType.value;
            let displayColor;
            let colorNameText;
            let colorInfoText = '';

            const input = document.querySelector('#colorInput') || document.querySelector('.number-input');
            if (!input || !input.value.trim()) {
                colorBox.style.backgroundColor = '#F0F0F0';
                colorName.textContent = texts.initialHint;
                colorInfo.textContent = '';
                return;
            }

            switch (type) {
                case 'hex':
                    let hexValue = input.value.trim().replace(/^#/, '');
                    
                    if (/^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$/.test(hexValue)) {
                        if (hexValue.length === 3) {
                            hexValue = hexValue[0] + hexValue[0] + hexValue[1] + hexValue[1] + hexValue[2] + hexValue[2];
                        }
                        displayColor = '#' + hexValue;
                        const rgb = hexToRGB(displayColor);
                        const [h, s, l] = rgbToHSL(rgb.r, rgb.g, rgb.b);
                        const [hb, sb, v] = rgbToHSB(rgb.r, rgb.g, rgb.b);
                        
                        // 缓存所有格式的值
                        currentColor = {
                            hex: displayColor,
                            rgb: { r: rgb.r, g: rgb.g, b: rgb.b },
                            hsl: { h, s, l },
                            hsb: { h: hb, s: sb, b: v }
                        };

                        colorNameText = getColorName(displayColor) || texts.customColor;
                        colorInfoText = `HEX: ${displayColor}\nRGB: ${rgb.r}, ${rgb.g}, ${rgb.b}\nHSL: ${h}, ${s}%, ${l}%\nHSB: ${hb}, ${sb}%, ${v}%`;
                    }
                    break;

                case 'rgb':
                    const rgbInputs = document.querySelectorAll('.number-input');
                    const rgbValues = Array.from(rgbInputs).map(input => parseInt(input.value));
                    if (rgbValues.every(v => !isNaN(v) && v >= 0 && v <= 255)) {
                        const [r, g, b] = rgbValues;
                        displayColor = `rgb(${r}, ${g}, ${b})`;
                        const hex = rgbToHex(r, g, b);
                        const [h, s, l] = rgbToHSL(r, g, b);
                        const [hb, sb, v] = rgbToHSB(r, g, b);
                        
                        // 缓存所有格式的值
                        currentColor = {
                            hex,
                            rgb: { r, g, b },
                            hsl: { h, s, l },
                            hsb: { h: hb, s: sb, b: v }
                        };

                        colorNameText = getColorName(hex) || texts.customColor;
                        colorInfoText = `HEX: ${hex}\nRGB: ${r}, ${g}, ${b}\nHSL: ${h}, ${s}%, ${l}%\nHSB: ${hb}, ${sb}%, ${v}%`;
                    }
                    break;

                case 'hsl':
                    const hslInputs = document.querySelectorAll('.number-input');
                    const hslValues = Array.from(hslInputs).map(input => parseInt(input.value));
                    if (hslValues.every(v => !isNaN(v)) && 
                        hslValues[0] >= 0 && hslValues[0] <= 360 &&
                        hslValues[1] >= 0 && hslValues[1] <= 100 &&
                        hslValues[2] >= 0 && hslValues[2] <= 100) {
                        const [h, s, l] = hslValues;
                        const rgb = hslToRGB(h, s, l);
                        const hex = rgbToHex(...rgb);
                        const [hb, sb, v] = rgbToHSB(...rgb);
                        
                        // 缓存所有格式的值
                        currentColor = {
                            hex,
                            rgb: { r: rgb[0], g: rgb[1], b: rgb[2] },
                            hsl: { h, s, l },
                            hsb: { h: hb, s: sb, b: v }
                        };

                        displayColor = hex;
                        colorNameText = getColorName(hex) || texts.customColor;
                        colorInfoText = `HEX: ${hex}\nRGB: ${rgb.join(', ')}\nHSL: ${h}, ${s}%, ${l}%\nHSB: ${hb}, ${sb}%, ${v}%`;
                    }
                    break;

                case 'hsb':
                    const hsbInputs = document.querySelectorAll('.number-input');
                    const hsbValues = Array.from(hsbInputs).map(input => parseInt(input.value));
                    if (hsbValues.every(v => !isNaN(v)) && 
                        hsbValues[0] >= 0 && hsbValues[0] <= 360 &&
                        hsbValues[1] >= 0 && hsbValues[1] <= 100 &&
                        hsbValues[2] >= 0 && hsbValues[2] <= 100) {
                        const [h, s, b] = hsbValues;
                        const rgb = hsbToRGB(h, s, b);
                        const hex = rgbToHex(...rgb);
                        const [hl, sl, l] = rgbToHSL(...rgb);
                        
                        // 缓存所有格式的值
                        currentColor = {
                            hex,
                            rgb: { r: rgb[0], g: rgb[1], b: rgb[2] },
                            hsl: { h: hl, s: sl, l },
                            hsb: { h, s, b }
                        };

                        displayColor = hex;
                        colorNameText = getColorName(hex) || texts.customColor;
                        colorInfoText = `HEX: ${hex}\nRGB: ${rgb.join(', ')}\nHSL: ${hl}, ${sl}%, ${l}%\nHSB: ${h}, ${s}%, ${b}%`;
                    }
                    break;
            }

            if (displayColor) {
                colorBox.style.backgroundColor = displayColor;
                colorName.textContent = colorNameText || texts.invalidColor;
                colorInfo.textContent = colorInfoText;
                updateSearchResultsBackground(displayColor);
            } else {
                colorBox.style.backgroundColor = '#F0F0F0';
                colorName.textContent = texts.invalidColor;
                colorInfo.textContent = '';
                updateSearchResultsBackground('#F0F0F0');
            }
        }

        function hexToRGB(hex) {
            // 移除 # 号（如果存在）
            hex = hex.replace(/^#/, '');
            
            // 解析 RGB 值
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return { r, g, b };
        }

        function rgbToHex(r, g, b) {
            return '#' + [r, g, b]
                .map(x => Math.round(x).toString(16).padStart(2, '0'))
                .join('')
                .toUpperCase();
        }

        function rgbToHSL(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                switch (max) {
                    case r:
                        h = (g - b) / d + (g < b ? 6 : 0);
                        break;
                    case g:
                        h = (b - r) / d + 2;
                        break;
                    case b:
                        h = (r - g) / d + 4;
                        break;
                }

                h /= 6;
            }

            return [
                Math.round(h * 360),
                Math.round(s * 100),
                Math.round(l * 100)
            ];
        }

        function rgbToHSB(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, v = max;

            const d = max - min;
            s = max === 0 ? 0 : d / max;

            if (max === min) {
                h = 0;
            } else {
                switch (max) {
                    case r:
                        h = (g - b) / d + (g < b ? 6 : 0);
                        break;
                    case g:
                        h = (b - r) / d + 2;
                        break;
                    case b:
                        h = (r - g) / d + 4;
                        break;
                }
                h /= 6;
            }

            return [
                Math.round(h * 360),
                Math.round(s * 100),
                Math.round(v * 100)
            ];
        }

        function hsbToRGB(h, s, b) {
            h /= 360;
            s /= 100;
            b /= 100;

            let r, g, bl;
            const i = Math.floor(h * 6);
            const f = h * 6 - i;
            const p = b * (1 - s);
            const q = b * (1 - f * s);
            const t = b * (1 - (1 - f) * s);

            switch (i % 6) {
                case 0:
                    r = b; g = t; bl = p;
                    break;
                case 1:
                    r = q; g = b; bl = p;
                    break;
                case 2:
                    r = p; g = b; bl = t;
                    break;
                case 3:
                    r = p; g = q; bl = b;
                    break;
                case 4:
                    r = t; g = p; bl = b;
                    break;
                case 5:
                    r = b; g = p; bl = q;
                    break;
            }

            return [
                Math.round(r * 255),
                Math.round(g * 255),
                Math.round(bl * 255)
            ];
        }

        function hslToRGB(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;

            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };

                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;

                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }

            return [
                Math.round(r * 255),
                Math.round(g * 255),
                Math.round(b * 255)
            ];
        }

        function hsbToHex(...args) {
            return rgbToHex(...hsbToRGB(...args));
        }

        function hslToHex(...args) {
            return rgbToHex(...hslToRGB(...args));
        }

        function getColorName(color) {
            // 如果是十六进制颜色，先转换为RGB
            if (color.startsWith('#')) {
                const rgb = hexToRGB(color);
                color = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            }
            
            // 尝试在colorData中找到最接近的颜色
            if (colorData && colorData.length > 0) {
                // 将输入的颜色转换为RGB值
                let inputRGB;
                if (color.startsWith('rgb')) {
                    const matches = color.match(/\d+/g);
                    if (matches) {
                        inputRGB = {
                            r: parseInt(matches[0]),
                            g: parseInt(matches[1]),
                            b: parseInt(matches[2])
                        };
                    }
                }

                if (inputRGB) {
                    // 计算与每个已知颜色的差异
                    let closestColor = null;
                    let minDifference = Infinity;

                    colorData.forEach(c => {
                        const rgb = hexToRGB(c.hex);
                        // 使用加权欧几里得距离计算颜色差异
                        // 人眼对绿色最敏感，其次是红色，最后是蓝色
                        const difference = Math.sqrt(
                            2 * Math.pow(inputRGB.r - rgb.r, 2) +
                            4 * Math.pow(inputRGB.g - rgb.g, 2) +
                            1 * Math.pow(inputRGB.b - rgb.b, 2)
                        );

                        if (difference < minDifference) {
                            minDifference = difference;
                            closestColor = c;
                        }
                    });

                    // 降低阈值，使匹配更精确
                    if (closestColor && minDifference < 10) {
                        return closestColor.name;
                    }
                }
            }
            
            return null;
        }

        function hslToHSB(h, s, l) {
            // 首先将HSL转换为RGB
            const rgb = hslToRGB(h, s, l);
            // 然后将RGB转换为HSB
            return rgbToHSB(rgb[0], rgb[1], rgb[2]);
        }

        function hsbToHSL(h, s, b) {
            // 首先将HSB转换为RGB
            const rgb = hsbToRGB(h, s, b);
            // 然后将RGB转换为HSL
            return rgbToHSL(rgb[0], rgb[1], rgb[2]);
        }

        // 修改初始化逻辑
        colorType.addEventListener('change', () => {
            // 保存当前颜色值
            const currentDisplayColor = colorBox.style.backgroundColor;
            let rgb;
            
            // 如果有当前颜色，转换为RGB值
            if (currentDisplayColor && currentDisplayColor !== '#F0F0F0') {
                if (currentDisplayColor.startsWith('#')) {
                    rgb = hexToRGB(currentDisplayColor);
                } else if (currentDisplayColor.startsWith('rgb')) {
                    const matches = currentDisplayColor.match(/\d+/g);
                    if (matches) {
                        rgb = {
                            r: parseInt(matches[0]),
                            g: parseInt(matches[1]),
                            b: parseInt(matches[2])
                        };
                    }
                }
            }

            // 创建新的输入字段
            createInputFields(colorType.value);

            // 如果有RGB值，更新输入字段
            if (rgb) {
                const type = colorType.value;
                switch (type) {
                    case 'hex':
                        const hexValue = rgbToHex(rgb.r, rgb.g, rgb.b).replace('#', '');
                        document.querySelector('#colorInput').value = hexValue;
                        break;
                    case 'rgb':
                        const rgbInputs = document.querySelectorAll('.number-input');
                        rgbInputs[0].value = rgb.r;
                        rgbInputs[1].value = rgb.g;
                        rgbInputs[2].value = rgb.b;
                        break;
                    case 'hsl':
                        const [h, s, l] = rgbToHSL(rgb.r, rgb.g, rgb.b);
                        const hslInputs = document.querySelectorAll('.number-input');
                        hslInputs[0].value = h;
                        hslInputs[1].value = s;
                        hslInputs[2].value = l;
                        break;
                    case 'hsb':
                        const [hb, sb, v] = rgbToHSB(rgb.r, rgb.g, rgb.b);
                        const hsbInputs = document.querySelectorAll('.number-input');
                        hsbInputs[0].value = hb;
                        hsbInputs[1].value = sb;
                        hsbInputs[2].value = v;
                        break;
                }
            }
        });

        // 初始加载
        createInputFields('hex');
        loadColorData();

        // 添加复制功能
        function showTooltip(message, x, y) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = message;
            tooltip.style.left = `${x}px`;
            tooltip.style.top = `${y - 40}px`;
            tooltip.classList.add('show');
            setTimeout(() => {
                tooltip.classList.remove('show');
            }, 2000);
        }

        document.getElementById('copyButton').addEventListener('click', async (e) => {
            const type = colorType.value;
            let textToCopy = '';
            
            // 获取当前输入框的值
            switch (type) {
                case 'hex':
                    const hexInput = document.querySelector('#colorInput');
                    textToCopy = hexInput ? '#' + hexInput.value : '';
                    break;
                case 'rgb':
                    const rgbInputs = document.querySelectorAll('.number-input');
                    if (rgbInputs.length === 3) {
                        const [r, g, b] = Array.from(rgbInputs).map(input => input.value);
                        textToCopy = `rgb(${r}, ${g}, ${b})`;
                    }
                    break;
                case 'hsl':
                    const hslInputs = document.querySelectorAll('.number-input');
                    if (hslInputs.length === 3) {
                        const [h, s, l] = Array.from(hslInputs).map(input => input.value);
                        textToCopy = `hsl(${h}, ${s}%, ${l}%)`;
                    }
                    break;
                case 'hsb':
                    const hsbInputs = document.querySelectorAll('.number-input');
                    if (hsbInputs.length === 3) {
                        const [h, s, b] = Array.from(hsbInputs).map(input => input.value);
                        textToCopy = `${h}, ${s}%, ${b}%`;
                    }
                    break;
                case 'css':
                    const cssInput = document.querySelector('#colorInput');
                    textToCopy = cssInput ? cssInput.value : '';
                    break;
            }

            if (textToCopy) {
                try {
                    await navigator.clipboard.writeText(textToCopy);
                    showTooltip(texts.copySuccess, e.clientX, e.clientY);
                } catch (err) {
                    showTooltip(texts.copyFailed, e.clientX, e.clientY);
                }
            }
        });

        // 添加保存图片功能
        document.getElementById('saveButton').addEventListener('click', async (e) => {
            const colorBox = document.getElementById('colorBox');
            try {
                // 创建一个新的 canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 设置 canvas 尺寸
                canvas.width = colorBox.offsetWidth;
                canvas.height = colorBox.offsetHeight;

                // 绘制背景色
                ctx.fillStyle = colorBox.style.backgroundColor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 设置文字样式
                ctx.fillStyle = 'white';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 2;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;

                // 绘制颜色名称
                ctx.font = '16px "Microsoft YaHei"';
                const colorName = document.getElementById('colorName').textContent;
                ctx.fillText(colorName, canvas.width / 2, canvas.height / 2 - 15);

                // 绘制颜色信息
                ctx.font = '14px "Microsoft YaHei"';
                const colorInfo = document.getElementById('colorInfo').textContent;
                ctx.fillText(colorInfo, canvas.width / 2, canvas.height / 2 + 15);

                // 转换为图片并下载
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = `color-${Date.now()}.png`;
                link.href = dataUrl;
                link.click();

                showTooltip(texts.saveSuccess, e.clientX, e.clientY);
            } catch (err) {
                showTooltip(texts.saveFailed, e.clientX, e.clientY);
            }
        });

        // 添加色彩灵感生成功能
        function generateColorInspirations(baseColor) {
            const inspirations = {
                gradient: [], // 渐变过渡
                analogous: [], // 相近色调
                complementary: [], // 对比色
                temperature: [] // 暖冷平衡
            };

            // 将颜色转换为HSL格式以便操作
            let rgb = hexToRGB(baseColor);
            let [h, s, l] = rgbToHSL(rgb.r, rgb.g, rgb.b);

            // 生成渐变过渡色
            for (let i = -30; i <= 30; i += 15) {
                const newL = Math.max(0, Math.min(100, l + i));
                const rgb = hslToRGB(h, s, newL);
                inspirations.gradient.push(rgbToHex(...rgb));
            }

            // 生成相近色调
            for (let i = -30; i <= 30; i += 15) {
                const newH = (h + i + 360) % 360;
                const rgb = hslToRGB(newH, s, l);
                inspirations.analogous.push(rgbToHex(...rgb));
            }

            // 生成对比色
            for (let i = 150; i <= 210; i += 15) {
                const newH = (h + i + 360) % 360;
                const rgb = hslToRGB(newH, s, l);
                inspirations.complementary.push(rgbToHex(...rgb));
            }

            // 生成暖冷平衡色
            const temperatures = [-30, -15, 0, 15, 30];
            temperatures.forEach(temp => {
                const newH = (h + temp + 360) % 360;
                const newS = Math.max(0, Math.min(100, s + (temp < 0 ? 10 : -10)));
                const rgb = hslToRGB(newH, newS, l);
                inspirations.temperature.push(rgbToHex(...rgb));
            });

            return inspirations;
        }

        function displayColorInspirations(inspirations) {
            const container = document.getElementById('colorInspirations');
            const titles = {
                gradient: texts.gradientTitle,
                analogous: texts.analogousTitle,
                complementary: texts.complementaryTitle,
                temperature: texts.temperatureTitle
            };

            container.innerHTML = Object.entries(inspirations)
                .map(([key, colors]) => `
                    <div class="inspiration-group">
                        <div class="inspiration-title">${titles[key]}</div>
                        <div class="inspiration-colors">
                            ${colors.map(color => `
                                <div class="inspiration-color" 
                                     style="background-color: ${color}"
                                     data-hex="${color}"
                                     onclick="selectInspirationColor('${color}')">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');

            container.classList.add('show');
        }

        function selectInspirationColor(color) {
            // 更新输入框和显示
            const hexInput = document.querySelector('#colorInput');
            if (hexInput) {
                hexInput.value = color.replace('#', '');
                updateColor();
            }
        }

        // 添加魔法棒按钮事件监听
        document.getElementById('inspirationButton').addEventListener('click', (e) => {
            const currentColor = colorBox.style.backgroundColor;
            if (currentColor && currentColor !== '#F0F0F0') {
                let hex;
                if (currentColor.startsWith('#')) {
                    hex = currentColor;
                } else if (currentColor.startsWith('rgb')) {
                    const matches = currentColor.match(/\d+/g);
                    if (matches) {
                        const [r, g, b] = matches.map(Number);
                        hex = rgbToHex(r, g, b);
                    }
                }

                if (hex) {
                    const inspirations = generateColorInspirations(hex);
                    displayColorInspirations(inspirations);
                    showTooltip(texts.generateSuccess, e.clientX, e.clientY);
                } else {
                    showTooltip(texts.selectColorFirst, e.clientX, e.clientY);
                }
            } else {
                showTooltip(texts.selectColorFirst, e.clientX, e.clientY);
            }
        });
    </script>
</body>
</html> 